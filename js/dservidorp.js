const formulario = document.getElementById('form-servidorp'); //Acceder a formulario
const inputs = document.querySelectorAll('#form-servidorp input'); //Acceder a inputs
const textareas = document.querySelectorAll('#form-servidorp textarea'); //Acceder a textarea

const expresiones = {
    asunto: /^([A-Za-z0-9À-ÿ\_\-\.\,\#\s]){0,60}$/,
    //descripcion: /^([A-Za-z0-9À-ÿ\_\-\.\,\#\s]){0,1000}$/
    descripcion: /^([\s\S]){0,1000}$/
}
          
const campos = {
    asunto: false,
    descripcion: false,
    evidencia: false
}

const validarFormulario = (e) => { //Identificar y validar inputs.
    switch (e.target.name){
        case "asunto":
            validarCampo(expresiones.asunto, e.target, 'asunto', 'div-asunto', 'form_asunto', 'alerta-asunto');
        break;
        case "descripcion":
            validarTextarea(expresiones.descripcion, e.target, 'descripcion', 'div-descripcion', 'form_descripcion', 'alerta-descripcion');
        break;
    }
}

const validarCampo = (expresion, input, campo, ideUno, ideDos, ideTres) => {
    if(expresion.test(input.value)){
        document.getElementById(ideUno).classList.remove('incorrecto');
        document.getElementById(ideDos).classList.remove('input-incorrecto'); 
        document.getElementById(ideTres).classList.remove('alerta-incorrecto');
        campos[campo] = true;
    } else {
        document.getElementById(ideUno).classList.add('incorrecto');
        document.getElementById(ideDos).classList.add('input-incorrecto');
        document.getElementById(ideTres).classList.add('alerta-incorrecto');
        campos[campo] = false;
    }
}

function validarTipo(ideUno, ideDos, ideTres){
    let divTipo = document.getElementById("form_tipo");
    let tipo = divTipo.value;
    console.log(tipo);

    if(tipo==""){  //Si no se ha seleccionado opción de sexo. 
        document.getElementById(ideUno).classList.add('incorrecto');
        document.getElementById(ideDos).classList.add('input-incorrecto');
        document.getElementById(ideTres).classList.add('alerta-incorrecto'); 
                         //Se impide enviar datos por 2 segundos.
        setTimeout(() => {
            document.getElementById(ideUno).classList.remove('incorrecto');
            document.getElementById(ideDos).classList.remove('input-incorrecto'); 
            document.getElementById(ideTres).classList.remove('alerta-incorrecto');

            document.getElementById('boton-registrar').disabled = false;
            document.getElementById('boton-registrar').classList.remove('deshabilitado');
        },2000);
        return false;
    }else { //Si se ha seleccionado una opción. 
        document.getElementById(ideUno).classList.remove('incorrecto');
        document.getElementById(ideDos).classList.remove('input-incorrecto'); 
        document.getElementById(ideTres).classList.remove('alerta-incorrecto');
        return true;
    }
}

const validarTextarea = (expresion, textarea, campo, ideUno, ideDos, ideTres) => {
    if(expresion.test(textarea.value)){
        document.getElementById(ideUno).classList.remove('incorrecto');
        document.getElementById(ideDos).classList.remove('input-incorrecto'); 
        document.getElementById(ideTres).classList.remove('alerta-incorrecto');
        campos[campo] = true;
    } else {
        document.getElementById(ideUno).classList.add('incorrecto');
        document.getElementById(ideDos).classList.add('input-incorrecto');
        document.getElementById(ideTres).classList.add('alerta-incorrecto');
        campos[campo] = false;
    }
}

const validarEvidencia = () => {
    var evidencia = document.getElementById('evidencia');
    var archivo = evidencia.value;
    var extensiones = /(.pdf|.docx|.jpg|.png|.PDF|.DOCX|.JPG|.PNG)$/i;


    if(archivo == ""){
        campos["evidencia"] = true;
        return true

    }else{
        var peso = evidencia.files[0].size;

                //Si se cumplen las condiciones
        if(extensiones.exec(archivo)){  
            if(peso < 16777216){
                document.getElementById('alerta-evidencia-peso').classList.remove('alerta-incorrecto');
                document.getElementById('div-archivo').classList.remove('control-archivo-incorrecto');
                campos["evidencia"] = true;
                return true;

                //Si no se cumplen las condiciones
            }else{
                evidencia.value = "";
                document.getElementById('alerta-evidencia-peso').classList.add('alerta-incorrecto'); 
                document.getElementById('div-archivo').classList.add('control-archivo-incorrecto');
                            //Se impide enviar datos por 8 segundos.
                setTimeout(() => { 
                    document.getElementById('alerta-evidencia-peso').classList.remove('alerta-incorrecto'); 
                    document.getElementById('div-archivo').classList.remove('control-archivo-incorrecto');

                    document.getElementById('boton-registrar').disabled = false;
                    document.getElementById('boton-registrar').classList.remove('deshabilitado');
                },8000);

                campos["evidencia"] = false;
                return false;
            }
        }else if(!extensiones.exec(archivo)){ 
            evidencia.value = "";

            document.getElementById('alerta-evidencia').classList.add('alerta-incorrecto'); 
            document.getElementById('div-archivo').classList.add('control-archivo-incorrecto');
                            //Se impide enviar datos por 8 segundos.
            setTimeout(() => { 
                document.getElementById('alerta-evidencia').classList.remove('alerta-incorrecto'); 
                document.getElementById('div-archivo').classList.remove('control-archivo-incorrecto');

                document.getElementById('boton-registrar').disabled = false;
                document.getElementById('boton-registrar').classList.remove('deshabilitado');
            },8000);
            campos["evidencia"] = false;
            return false;
        }
    }
}

inputs.forEach((input) => {
    input.addEventListener('keyup', validarFormulario); //Evento soltar tecla.
    input.addEventListener('blur', validarFormulario);  //Evento click fuera de input.
});

textareas.forEach((textarea) => {
    textarea.addEventListener('keyup', validarFormulario); //Evento soltar tecla.
    textarea.addEventListener('blur', validarFormulario);  //Evento click fuera de input.
});

const analizarCampos = () => {
    /*console.log("nombre " + campos.nombre);
    console.log("edad " +campos.edad);
    console.log("telefono " +campos.telefono);
    console.log("correo " +campos.correo);
    console.log("direccion " +campos.direccion);*/
    if(campos.asunto && campos.descripcion){
        document.getElementById('boton-registrar').disabled = false;
        document.getElementById('boton-registrar').classList.remove('deshabilitado');
    }
}

formulario.addEventListener('mouseout', (e) =>{
    analizarCampos();
})

formulario.addEventListener('submit', (e) => {   //Evento de botón.
    /*console.log("nombre " + campos.nombre);
    console.log("edad " +campos.edad);
    console.log("telefono " +campos.telefono);
    console.log("correo " +campos.correo);
    console.log("direccion " +campos.direccion);*/

    if(!validarTipo('div-tipo', 'form_tipo', 'alerta-tipo')){
        e.preventDefault();
    }

    if(!validarEvidencia()){
        e.preventDefault();
    }

    if(campos.asunto && campos.descripcion && campos.evidencia){
        document.getElementById('mensaje').classList.add('mensaje-exito');
        document.getElementById('mensaje-texto2').classList.add('mensaje-texto-exito');
        setTimeout(() => {
            e.preventDefault();
            document.getElementById('mensaje').classList.remove('mensaje-exito');
            document.getElementById('mensaje-texto2').classList.remove('mensaje-texto-exito');
        }, 5000);
    } else {
        document.getElementById('boton-registrar').classList.add('deshabilitado');
        document.getElementById('boton-registrar').disabled = true;
        document.getElementById('mensaje').classList.add('mensaje-error');
        document.getElementById('mensaje-texto1').classList.add('mensaje-texto-error');
        setTimeout(() => {
            document.getElementById('mensaje').classList.remove('mensaje-error');
            document.getElementById('mensaje-texto1').classList.remove('mensaje-texto-error');
        }, 5000);
        e.preventDefault();
    }
})